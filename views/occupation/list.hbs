<script>
    
    $(document).ready(function () {
        $('.editButton').click(function () {
            $(this).closest('tr').find('#rate').removeAttr('disabled');
            $(this).closest('tr').find('#changeOccupation').removeAttr('hidden');
            $('.editButton').attr('disabled', 'true');
        })
    });

    $(document).ready(function () {
        $('.changeButton').click(function () {
            let occupationID = $(this).closest('tr').find('#id').val();
            let occupationNewRate = $(this).closest('tr').find('#rate').val();

            let url = '/occupation/edit/' + occupationID;

            $.post(url,
                    {occupationID: occupationID,
                        occupationRate: occupationNewRate,
                    }, function () {
                    });

            window.location.replace('/occupation/list/')
        })
    })
    
</script>

<main>
    {{#if user}}

        <ol class="container breadcrumb transparent">
        <li><a href="/project/list">Home</a></li>
        <li><a href="/rate/list">Manage rates</a></li>
        <li class="active">All Occupations</li>
    </ol>

        <div class="container">

            <div class="page-header">
                <h1>All occupations</h1>
            </div>

            <!-- List with All Occupations -->
            <div class="col-lg-12">

                <table class="table" id="occupations">

                    <!-- Table Head -->
                    <tr>
                        <th>Occupation</th>
                        <th>Rate</th>
                        <th></th>
                        <th></th>
                    </tr>

                    <!-- Table Data -->
                    {{#each occupations}}
                        <tr>

                            <!-- Occupation Name -->
                            <form class="form-horizontal" method="post" action="/occupation/edit">
                                <td class="form-group" id="occupationName">
                                    <h6 class="form-control-static"><strong>{{this.occupationName}}</strong></h6>
                                </td>

                                <!-- Occupation ID - hidden -->
                                <td  hidden class="form-group" id="occupationID">
                                    <input id="id" type="text" disabled class="form-control" value="{{this.id}}">
                                </td>


                                <!-- Occupation Rate -->
                                <td class="form-group" id="occupationRate">
                                    <input id="rate" type="number" step="0.01" disabled class="form-control" value="{{this.occupationRate}}">
                                </td>
                            </form>

                            <!-- Edit -->
                            <td class="" id="occupationEdit">
                                <div class="btn btn-primary editButton" id="editOccupationButton">Edit</div>
                            </td>

                            <!-- Edit -->
                            <td class="" id="changeOccupation" hidden>
                                <div  class="btn btn-info changeButton" id="changeOccupationButton">Change</div>
                            </td>

                        </tr>
                    {{/each}}
                </table>

                <a href="/rate/list">
                    <button class="btn btn-default pull-right" style="margin-bottom: 20px">
                        <span class="glyphicon glyphicon-menu-left"></span>
                        Back to Users
                    </button>
                </a>

            </div>
        </div>
    {{/if}}
</main>